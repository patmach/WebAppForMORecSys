@using WebAppForMORecSys.Models.ViewModels
@model WebAppForMORecSys.Models.ViewModels.MainViewModel
@{
    string controller = WebAppForMORecSys.Settings.SystemParameters.Controller;
    int index = 0;
    Metric[] metricsArr = Model.Metrics.Keys.ToArray();
}
    @foreach (var item in Model.Items)
    {
        Dictionary<Metric, double> metricsContribution = new Dictionary<Metric, double>();

        if (Model.ItemsToMetricContributionScore != null)
        {
            metricsContribution = Enumerable.Range(0, Model.Metrics.Count)
            .ToDictionary(i => metricsArr[i], i => Model.ItemsToMetricContributionScore[index][i]);
        }

        @await Html.PartialAsync("../"+controller+"/Preview", new PreviewDetailViewModel(item, Model.User, Model.UserRatings, metricsContribution, Model.UsedVariants))
        @if (metricsContribution.Count > 0)
        {
            @await Html.PartialAsync("../Shared/Explanations", new PreviewDetailViewModel(item, Model.User, Model.UserRatings, metricsContribution, Model.UsedVariants))
        }
        index++;
    }

